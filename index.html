<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Recipe Book</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fafafa;
}

header {
    padding: 1rem;
    background: #ffffff;
    border-bottom: 1px solid #ddd;
}

.layout {
    display: grid;
    grid-template-columns: 260px 1fr;
    height: calc(100vh - 72px);
}

.sidebar {
    overflow-y: auto;
    border-right: 1px solid #ddd;
    background: #fff;
    padding: 1rem;
}

.sidebar a {
    display: block;
    color: #333;
    text-decoration: none;
    margin-bottom: 0.4rem;
    font-size: 0.9rem;
}

.sidebar a:hover {
    text-decoration: underline;
}

main {
    overflow-y: auto;
    padding: 1.5rem;
}

.recipe {
    background: #fff;
    padding: 1rem;
    margin-bottom: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.meta-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.meta-item {
    background: #f4f4f4;
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.85rem;
}

.meta-label {
    display: block;
    font-size: 0.7rem;
    color: #666;
    font-weight: bold;
    text-transform: uppercase;
}
</style>
</head>

<body>

<header>
    <h1>Family Recipe Book</h1>
</header>

<div class="layout">
    <nav class="sidebar" id="recipeIndex"></nav>
    <main id="recipes"></main>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
const recipesFolder = 'recipes/';
const container = document.getElementById('recipes');
const indexEl = document.getElementById('recipeIndex');

function parseFrontmatter(md) {
    const fm = md.match(/^---\s*([\s\S]*?)\s*---\s*/);
    if (!fm) return { meta: {}, body: md };

    const meta = {};
    fm[1].split(/\r?\n/).forEach(line => {
        const i = line.indexOf(':');
        if (i === -1) return;
        meta[line.slice(0, i).trim()] = line.slice(i + 1).trim();
    });

    return {
        meta,
        body: md.slice(fm[0].length).trim()
    };
}

function slugify(text) {
    return text.toLowerCase().replace(/[^a-z0-9]+/g, '-');
}

axios.get(recipesFolder + 'index.json')
    .then(res => res.data)
    .then(files => Promise.all(
        files.map(filename =>
            axios.get(recipesFolder + filename)
                .then(r => ({ filename, md: r.data }))
        )
    ))
    .then(results => {
        results.forEach(({ filename, md }) => {
            const { meta, body } = parseFrontmatter(md);
            const id = slugify(meta.title || filename);

            indexEl.insertAdjacentHTML(
                'beforeend',
                `<a href="#${id}">${meta.title || filename}</a>`
            );

            const article = document.createElement('article');
            article.className = 'recipe';
            article.id = id;

            article.innerHTML = `
                <h2>${meta.title || 'Untitled'}</h2>
                <div class="meta-grid">
                    ${meta.persons ? `<div class="meta-item"><span class="meta-label">Persons</span>${meta.persons}</div>` : ''}
                    ${meta.prep_time ? `<div class="meta-item"><span class="meta-label">Prep</span>${meta.prep_time}</div>` : ''}
                    ${meta.cook_time ? `<div class="meta-item"><span class="meta-label">Cook</span>${meta.cook_time}</div>` : ''}
                    ${meta.category ? `<div class="meta-item"><span class="meta-label">Category</span>${meta.category}</div>` : ''}
                    ${meta.cuisine ? `<div class="meta-item"><span class="meta-label">Cuisine</span>${meta.cuisine}</div>` : ''}
                    ${meta.source ? `<div class="meta-item"><span class="meta-label">Source</span>${meta.source}</div>` : ''}
                </div>
                <div class="content">${marked.parse(body)}</div>
            `;

            container.appendChild(article);
        });
    })
    .catch(err => console.error('Recipe load failed', err));
</script>

</body>
</html>
